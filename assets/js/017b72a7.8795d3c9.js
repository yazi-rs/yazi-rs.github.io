"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[7802],{1715:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>o,default:()=>p,frontMatter:()=>c,metadata:()=>i,toc:()=>h});const i=JSON.parse('{"id":"plugins/overview","title":"Plugins (BETA)","description":"Learn how to extend Yazi with Lua plugins.","source":"@site/docs/plugins/overview.md","sourceDirName":"plugins","slug":"/plugins/overview","permalink":"/docs/next/plugins/overview","draft":false,"unlisted":false,"editUrl":"https://github.com/yazi-rs/yazi-rs.github.io/edit/main/docs/plugins/overview.md","tags":[],"version":"current","sidebarPosition":0,"frontMatter":{"id":"overview","sidebar_position":0,"sidebar_label":"Plugins (BETA)","description":"Learn how to extend Yazi with Lua plugins."},"sidebar":"docsSidebar","previous":{"title":"Image Preview","permalink":"/docs/next/image-preview"},"next":{"title":"Types","permalink":"/docs/next/plugins/types"}}');var t=s(6070),r=s(7082),l=s(4633),a=s(6211);const c={id:"overview",sidebar_position:0,sidebar_label:"Plugins (BETA)",description:"Learn how to extend Yazi with Lua plugins."},o="Plugins (BETA)",d={},h=[{value:"Usage",id:"usage",level:2},{value:"Functional plugin",id:"functional-plugin",level:3},{value:"Sync vs Async",id:"sync-vs-async",level:2},{value:"Sync context",id:"sync-context",level:3},{value:"Async context",id:"async-context",level:3},{value:"Annotations",id:"annotations",level:2},{value:"<code>@sync</code>",id:"@sync",level:3},{value:"<code>@since</code>",id:"@since",level:3},{value:"Interface",id:"interface",level:2},{value:"Previewer",id:"previewer",level:3},{value:"Preloader",id:"preloader",level:3},{value:"Sendable value",id:"sendable",level:2},{value:"Ownership transfer",id:"ownership",level:2},{value:"Debugging",id:"debugging",level:2},{value:"Logging",id:"logging",level:3},{value:"Debugging preset plugins",id:"debugging-preset-plugins",level:3}];function u(e){const n={a:"a",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,r.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"plugins-beta",children:"Plugins (BETA)"})}),"\n",(0,t.jsxs)(n.p,{children:["You can extend Yazi's functionality through Lua plugins, which need to be placed in the ",(0,t.jsx)(n.code,{children:"plugins"})," subdirectory of Yazi's configuration directory, so either:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"~/.config/yazi/plugins/"})," on Unix-like systems."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"%AppData%\\yazi\\config\\plugins\\"})," on Windows."]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"~/.config/yazi/\n\u251c\u2500\u2500 init.lua\n\u251c\u2500\u2500 plugins/\n\u2502\xa0\xa0 \u251c\u2500\u2500 foo.yazi/\n\u2502\xa0\xa0 \u2514\u2500\u2500 bar.yazi/\n\u2514\u2500\u2500 yazi.toml\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Each plugin is a directory with a ",(0,t.jsx)(n.a,{href:"https://developer.mozilla.org/en-US/docs/Glossary/Kebab_case",children:"kebab-case"})," name, ending in ",(0,t.jsx)(n.code,{children:".yazi"}),", and containing at least the following files:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"~/.config/yazi/plugins/bar.yazi/\n\u251c\u2500\u2500 main.lua\n\u251c\u2500\u2500 README.md\n\u2514\u2500\u2500 LICENSE\n"})}),"\n",(0,t.jsx)(n.p,{children:"Where:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"main.lua"})," is the entry point of this plugin."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"README.md"})," is the documentation of this plugin."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"LICENSE"})," is the license file for this plugin."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"usage",children:"Usage"}),"\n",(0,t.jsx)(n.p,{children:"A plugin has two usages:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"#functional-plugin",children:"Functional plugin"}),": Bind the ",(0,t.jsx)(n.code,{children:"plugin"})," action to a key in ",(0,t.jsx)(n.code,{children:"keymap.toml"}),", and activate it by pressing the key."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/configuration/yazi#plugin",children:"Custom previewers, preloaders"}),": Configure them as previewers or preloaders under ",(0,t.jsx)(n.code,{children:"[plugin]"})," of your ",(0,t.jsx)(n.code,{children:"yazi.toml"}),"."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"functional-plugin",children:"Functional plugin"}),"\n",(0,t.jsxs)(n.p,{children:["You can bind a ",(0,t.jsx)(n.code,{children:"plugin"})," action to a specific key in your ",(0,t.jsx)(n.code,{children:"keymap.toml"})," with:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Argument/Option"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"[name]"})}),(0,t.jsx)(n.td,{children:"Required, the name of the plugin to run."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"[args]"})}),(0,t.jsx)(n.td,{children:"Optional, shell-style arguments passed to the plugin."})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["For example, ",(0,t.jsx)(n.code,{children:"plugin test -- foo --bar --baz=qux"})," will run the ",(0,t.jsx)(n.code,{children:"test"})," plugin with the arguments ",(0,t.jsx)(n.code,{children:"foo --bar --baz=qux"})," in an async context."]}),"\n",(0,t.jsxs)(n.p,{children:["To access the arguments in the plugin, use ",(0,t.jsx)(n.code,{children:"job.args"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'-- ~/.config/yazi/plugins/test.yazi/main.lua\nreturn {\n\tentry = function(self, job)\n\t\tya.dbg(job.args[1])  -- "foo"\n\t\tya.dbg(job.args.bar) -- true\n\t\tya.dbg(job.args.baz) -- "qux"\n\tend,\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that currently Yazi only supports positional arguments (",(0,t.jsx)(n.code,{children:"foo"}),") and named arguments (",(0,t.jsx)(n.code,{children:"--bar"}),"), it does not support shorthand arguments like ",(0,t.jsx)(n.code,{children:"-a"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Shorthands will be treated as positional arguments at the moment, but as Yazi adds support for it in the future, their behavior will change. So please avoid using them to prevent any potential conflicts."}),"\n",(0,t.jsx)(n.h2,{id:"sync-vs-async",children:"Sync vs Async"}),"\n",(0,t.jsxs)(n.p,{children:["The plugin system is designed with an async-first philosophy. Therefore, unless specifically specified, such as the ",(0,t.jsxs)(n.a,{href:"/docs/plugins/overview#@sync",children:[(0,t.jsx)(n.code,{children:"@sync"})," annotation"]}),", all plugins run in an async context."]}),"\n",(0,t.jsxs)(n.p,{children:["There is one exception: the user's ",(0,t.jsx)(n.code,{children:"init.lua"})," is synchronous, since ",(0,t.jsx)(n.code,{children:"init.lua"})," is often used to initialize plugin configurations:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'-- ~/.config/yazi/init.lua\nrequire("my-plugin"):setup {\n\tkey1 = "value1",\n\tkey2 = "value2",\n\t-- ...\n}\n'})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- ~/.config/yazi/plugins/my-plugin.yazi/main.lua\nreturn {\n\tsetup = function(state, opts)\n\t\t-- Save the user configuration to the plugin's state\n\t\tstate.key1 = opts.key1\n\t\tstate.key2 = opts.key2\n\tend,\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"sync-context",children:"Sync context"}),"\n",(0,t.jsxs)(n.p,{children:["The sync context accompanies the entire app lifecycle, which is active during UI rendering (UI plugins), and on executing ",(0,t.jsx)(n.a,{href:"/docs/plugins/overview#@sync",children:"sync functional plugins"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"For better performance, the sync context is created only at the app's start and remains singular throughout. Thus, plugins running within this context share states,\nprompting plugin developers to use plugin-specific state persistence for their plugins to prevent global space contamination:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'--- @sync entry\n-- ~/.config/yazi/test.yazi/main.lua\nreturn {\n  entry = function(state)\n    state.i = state.i or 0\n    ya.dbg("i = " .. state.i)\n\n    state.i = state.i + 1\n  end,\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Yazi initializes the ",(0,t.jsx)(n.code,{children:"state"})," for each ",(0,t.jsx)(n.em,{children:"sync"})," plugin before running, and it exists independently for them throughout the entire lifecycle.\nDo the ",(0,t.jsx)(n.code,{children:"plugin test"})," three times, and you will see the log output:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"i = 0\ni = 1\ni = 2\n"})}),"\n",(0,t.jsx)(n.h3,{id:"async-context",children:"Async context"}),"\n",(0,t.jsx)(n.p,{children:"When a plugin is executed asynchronously, an isolated async context is created for it automatically."}),"\n",(0,t.jsx)(n.p,{children:"In this context, you can use all the async functions supported by Yazi, and it operates concurrently with the main thread, ensuring that the main thread is not blocked."}),"\n",(0,t.jsxs)(n.p,{children:["You can also obtain ",(0,t.jsx)(n.a,{href:"#sendable",children:"a small amount"}),' of data from the sync context by calling a "sync block":']}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'-- ~/.config/yazi/plugins/my-async-plugin.yazi/main.lua\nlocal set_state = ya.sync(function(state, a)\n\t-- You can get/set the state of the plugin through `state` parameter\n\t-- in the `sync()` block\n\tstate.a = a\nend)\n\nlocal get_state = ya.sync(function(state, b)\n\t-- You can access all states through the `cx`,\n\t-- within the `sync()` block, in an async plugin\n\tlocal h = cx.active.current.hovered\n\treturn h and state.a .. tostring(h.url) or b\nend)\n\nreturn {\n\tentry = function()\n\t\tset_state("hello from a")\n\t\tlocal h = get_state("hello from b")\n\t\t-- Do some time-consuming work, such as reading file, network request, etc.\n\t\t-- It will execute concurrently with the main thread\n\tend,\n}\n'})}),"\n",(0,t.jsxs)(n.p,{children:["Note that ",(0,t.jsx)(n.code,{children:"ya.sync()"})," call must be at the top level:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"-- Wrong !!!\nlocal get_state\nif some_condition then\n\tget_state = ya.sync(function(state)\n\t\t-- ...\n\tend)\nend\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Passing data into and returning data from a ",(0,t.jsx)(n.code,{children:"ya.sync()"})," block involves cross-thread data exchange. If the data contains userdata, it causes ",(0,t.jsx)(n.a,{href:"/docs/plugins/overview#ownership",children:"Ownership transfer"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"annotations",children:"Annotations"}),"\n",(0,t.jsx)(n.p,{children:"Each plugin can contain zero or more annotations that specify the behavior of the plugin during runtime."}),"\n",(0,t.jsxs)(n.p,{children:["Each annotation starts with ",(0,t.jsx)(n.code,{children:"---"}),", followed by ",(0,t.jsx)(n.code,{children:"@"})," and the annotation name, and ends with the annotation's value."]}),"\n",(0,t.jsxs)(n.p,{children:["These annotations ",(0,t.jsx)(n.em,{children:"must"})," be at the very top of the file, with no content before them, and no non-annotation content should appear between annotations."]}),"\n",(0,t.jsx)(n.h3,{id:"@sync",children:(0,t.jsx)(n.code,{children:"@sync"})}),"\n",(0,t.jsx)(n.p,{children:"Specifies that a method in the plugin runs in a sync context instead of the default async context. Available values:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"entry"}),": Run the ",(0,t.jsx)(n.code,{children:"entry"})," method in a sync context."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"peek"}),": Run the ",(0,t.jsx)(n.code,{children:"peek"})," method in a sync context."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"For example:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"--- @sync entry\nreturn {\n\tentry = function() end\n}\n"})}),"\n",(0,t.jsx)(n.h3,{id:"@since",children:(0,t.jsx)(n.code,{children:"@since"})}),"\n",(0,t.jsx)(n.p,{children:"Specifies the minimum Yazi version that the plugin supports."}),"\n",(0,t.jsx)(n.p,{children:"If specified, and the user's Yazi version is lower than the specified one, an error will be triggered to prompt the user to upgrade their Yazi version, preventing the plugin from being executed accidentally:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"--- @since 25.2.13\nreturn {\n\t--- ...\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"interface",children:"Interface"}),"\n",(0,t.jsx)(n.h3,{id:"previewer",children:"Previewer"}),"\n",(0,t.jsxs)(n.p,{children:["A previewer needs to return a table that implements the ",(0,t.jsx)(n.code,{children:"peek"})," and ",(0,t.jsx)(n.code,{children:"seek"})," methods. Both methods take a table parameter ",(0,t.jsx)(n.code,{children:"job"})," and do not return any values:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:"local M = {}\n\nfunction M:peek(job)\n\t-- ...\nend\n\nfunction M:seek(job)\n\t-- ...\nend\n\nreturn M\n"})}),"\n",(0,t.jsxs)(n.p,{children:["When the user presses ",(0,t.jsx)("kbd",{children:"j"})," or ",(0,t.jsx)("kbd",{children:"k"})," to switch between hovering files, ",(0,t.jsx)(n.code,{children:"peek"})," is called, with:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"area"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/plugins/layout#rect",children:"Rect"})," of the available preview area."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"args"})}),(0,t.jsx)(n.td,{children:"Arguments passed to the previewer."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"file"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/plugins/types#file",children:"File"})," to be previewed."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"skip"})}),(0,t.jsx)(n.td,{children:"Number of units to skip. The units depend on your previewer, such as lines for code and percentages for videos."})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["When the user presses ",(0,t.jsx)("kbd",{children:"J"})," or ",(0,t.jsx)("kbd",{children:"K"})," to scroll the preview of the file, ",(0,t.jsx)(n.code,{children:"seek"})," is called, with:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"file"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/plugins/types#file",children:"File"})," being scrolled."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"area"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/plugins/layout#rect",children:"Rect"})," of the available preview area."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"units"})}),(0,t.jsx)(n.td,{children:"Number of units to scroll."})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["The task of ",(0,t.jsx)(n.code,{children:"peek"})," is to draw in the preview area based on the values of ",(0,t.jsx)(n.code,{children:"file"})," and ",(0,t.jsx)(n.code,{children:"skip"}),". This process is asynchronous."]}),"\n",(0,t.jsxs)(n.p,{children:["The task of ",(0,t.jsx)(n.code,{children:"seek"})," is to change the value of ",(0,t.jsx)(n.code,{children:"skip"})," based on user behavior and trigger ",(0,t.jsx)(n.code,{children:"peek"})," again. It's synchronous, meaning you can access ",(0,t.jsx)(n.a,{href:"/docs/plugins/context",children:"the context"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["There are some preset previewers and preloaders you can refer to: ",(0,t.jsx)(n.a,{href:"https://github.com/sxyazi/yazi/tree/shipped/yazi-plugin/preset/plugins",children:"Yazi Preset Plugins"})]}),"\n",(0,t.jsx)(n.h3,{id:"preloader",children:"Preloader"}),"\n",(0,t.jsxs)(n.p,{children:["You need to return a table that implements the ",(0,t.jsx)(n.code,{children:"preload"})," method:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'local M = {}\n\nfunction M:preload(job)\n\t-- ...\n\treturn false, Err("some error")\nend\n\nreturn M\n'})}),"\n",(0,t.jsxs)(n.p,{children:["It receives a ",(0,t.jsx)(n.code,{children:"job"})," parameter, which is a table:"]}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Key"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"area"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/plugins/layout#rect",children:"Rect"})," of the available preview area."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"args"})}),(0,t.jsx)(n.td,{children:"Arguments passed to the preloader."})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"file"})}),(0,t.jsxs)(n.td,{children:[(0,t.jsx)(n.a,{href:"/docs/plugins/types#file",children:"File"})," to be preloaded."]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"skip"})}),(0,t.jsxs)(n.td,{children:["Always ",(0,t.jsx)(n.code,{children:"0"})]})]})]})]}),"\n",(0,t.jsxs)(n.p,{children:["And returns a ",(0,t.jsx)(n.code,{children:"(complete, err)"}),":"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"complete"}),": Required, whether the preloading is complete, which is a boolean.","\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"true"}),": Marks the task as complete, and the task will not be called again."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"false"}),": Marks the task as incomplete, and the task will be retried until it's complete (returns ",(0,t.jsx)(n.code,{children:"true"}),")."]}),"\n"]}),"\n"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"err"}),": Optional, the error to be logged."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["When ",(0,t.jsx)(n.code,{children:"complete = false"}),", the preloader will be re-triggered at the next time point, such as when the user scrolls leading to a page switch. This is usually done for either:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Retrying in case of file loading failure"}),"\n",(0,t.jsx)(n.li,{children:"Refreshing the file status upon successful loading"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Yazi will automatically invoke the ",(0,t.jsx)(n.code,{children:"preload"})," concurrently for each file that matches the preload rules on the page."]}),"\n",(0,t.jsx)(n.h2,{id:"sendable",children:"Sendable value"}),"\n",(0,t.jsx)(n.p,{children:"Yazi's plugin can run concurrently on multiple threads. For better performance, only the following types of combinations can be used for inter-thread data exchange:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Nil"}),"\n",(0,t.jsx)(n.li,{children:"Boolean"}),"\n",(0,t.jsx)(n.li,{children:"Number"}),"\n",(0,t.jsx)(n.li,{children:"String"}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/plugins/types#url",children:"Url"})}),"\n",(0,t.jsx)(n.li,{children:"Table and nested tables, with the above types as values"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"ownership",children:"Ownership transfer"}),"\n",(0,t.jsxs)(n.p,{children:["Yazi's plugin system inherits ",(0,t.jsx)(n.a,{href:"https://doc.rust-lang.org/nomicon/ownership.html",children:"Rust's ownership and lifetime"})," concepts."]}),"\n",(0,t.jsxs)(n.p,{children:["All ",(0,t.jsx)(n.a,{href:"https://www.lua.org/pil/28.1.html",children:"userdata"})," are native Rust types that have their own ownership to ensure safe and efficient transfers across different threads, avoiding any memory reallocation overhead. Specifically:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.a,{href:"/docs/plugins/types#url",children:"Url"})}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Passing these userdata to a cross-thread function like ",(0,t.jsx)(n.a,{href:"/docs/plugins/utils#ya.emit",children:(0,t.jsx)(n.code,{children:"ya.emit()"})})," transfers ownership. After transfer, the original userdata is no longer available, for example:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'local target = Url("/tmp")\nya.emit("cd", { target })  -- Ownership transferred\n\nya.dbg(tostring(url)) -- Error: userdata has been destructed\n'})}),"\n",(0,t.jsxs)(n.p,{children:["To keep the original, clone a new userdata and pass that instead, but this allocates extra memory - ",(0,t.jsx)(n.code,{children:"Url()"})," constructor can accept a ",(0,t.jsx)(n.code,{children:"Url"})," userdata and return a new clone of that ",(0,t.jsx)(n.code,{children:"Url"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-diff",children:'- ya.emit("cd", { target })\n+ ya.emit("cd", { Url(target) })\n'})}),"\n",(0,t.jsxs)(n.p,{children:["A smarter way is to reverse the order of execution, use the ",(0,t.jsx)(n.code,{children:"target"})," before it's transferred, to avoid the need for cloning:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-lua",children:'local target = Url("/tmp")\nlocal target_str = tostring(target)\n\nya.emit("cd", { target })  -- Ownership transferred\nya.dbg(target_str) -- No error\n'})}),"\n",(0,t.jsx)(n.h2,{id:"debugging",children:"Debugging"}),"\n",(0,t.jsxs)(n.p,{children:["Please ensure that your ",(0,t.jsx)(n.code,{children:"~/.config/yazi/init.lua"})," includes valid Lua code with the correct syntax, otherwise will result in Yazi being unable to parse and execute your ",(0,t.jsx)(n.code,{children:"init.lua"})," to initialize."]}),"\n",(0,t.jsxs)(n.p,{children:["We recommend installing a Lua plugin in your editor for syntax checking to avoid any syntax errors.\nFor example, install the ",(0,t.jsx)(n.a,{href:"https://marketplace.visualstudio.com/items?itemName=sumneko.lua",children:"Lua plugin"})," for VSCode, and for Neovim, use ",(0,t.jsx)(n.a,{href:"https://github.com/neovim/nvim-lspconfig",children:"nvim-lspconfig"})," to configure your Lua LSP."]}),"\n",(0,t.jsxs)(n.p,{children:["If you have no experience with Lua, you can quickly get started through ",(0,t.jsx)(n.a,{href:"https://learnxinyminutes.com/docs/lua/",children:"https://learnxinyminutes.com/docs/lua/"})]}),"\n",(0,t.jsx)(n.h3,{id:"logging",children:"Logging"}),"\n",(0,t.jsxs)(n.p,{children:["If you want to debug some runtime data, use ",(0,t.jsx)(n.a,{href:"/docs/plugins/utils#ya.dbg",children:(0,t.jsx)(n.code,{children:"ya.dbg()"})})," and ",(0,t.jsx)(n.a,{href:"/docs/plugins/utils#ya.err",children:(0,t.jsx)(n.code,{children:"ya.err()"})})," to print what you want to debug to either:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"~/.local/state/yazi/yazi.log"})," on Unix-like systems."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"%AppData%\\yazi\\state\\yazi.log"})," on Windows."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Make sure to set the ",(0,t.jsx)(n.code,{children:"YAZI_LOG"})," environment variable before starting Yazi:"]}),"\n",(0,t.jsxs)(l.A,{children:[(0,t.jsx)(a.A,{value:"unix",label:"Unix-like",default:!0,children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"YAZI_LOG=debug yazi\n"})})}),(0,t.jsx)(a.A,{value:"powershell",label:"PowerShell",children:(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-powershell",children:'$env:YAZI_LOG = "debug"; yazi\n'})})})]}),"\n",(0,t.jsx)(n.p,{children:"otherwise, no logs will be recorded. Its value can be (in descending order of verbosity):"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"debug"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"info"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"warn"})}),"\n",(0,t.jsx)(n.li,{children:(0,t.jsx)(n.code,{children:"error"})}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"debugging-preset-plugins",children:"Debugging preset plugins"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsx)(n.li,{children:"Clone the latest source code."}),"\n",(0,t.jsxs)(n.li,{children:["Go to the ",(0,t.jsx)(n.code,{children:"yazi-plugin/preset"})," folder and find the plugin you want to debug, make changes, such as ",(0,t.jsx)(n.a,{href:"/docs/plugins/overview#logging",children:"logging certain runtime data"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/installation#debug",children:"Build in debug mode"})," and run the ",(0,t.jsx)(n.code,{children:"yazi"})," binary with an appropriate ",(0,t.jsx)(n.code,{children:"YAZI_LOG"}),"."]}),"\n"]})]})}function p(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(u,{...e})}):u(e)}},4633:(e,n,s)=>{s.d(n,{A:()=>k});var i=s(758),t=s(3526),r=s(6298),l=s(3033),a=s(5557),c=s(2959),o=s(162),d=s(1819),h=s(9347);function u(e){return i.Children.toArray(e).filter((e=>"\n"!==e)).map((e=>{if(!e||(0,i.isValidElement)(e)&&function(e){const{props:n}=e;return!!n&&"object"==typeof n&&"value"in n}(e))return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))?.filter(Boolean)??[]}function p(e){const{values:n,children:s}=e;return(0,i.useMemo)((()=>{const e=n??function(e){return u(e).map((({props:{value:e,label:n,attributes:s,default:i}})=>({value:e,label:n,attributes:s,default:i})))}(s);return function(e){const n=(0,d.XI)(e,((e,n)=>e.value===n.value));if(n.length>0)throw new Error(`Docusaurus error: Duplicate values "${n.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[n,s])}function x({value:e,tabValues:n}){return n.some((n=>n.value===e))}function g({queryString:e=!1,groupId:n}){const s=(0,a.W6)(),t=function({queryString:e=!1,groupId:n}){if("string"==typeof e)return e;if(!1===e)return null;if(!0===e&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:e,groupId:n});return[(0,o.aZ)(t),(0,i.useCallback)((e=>{if(!t)return;const n=new URLSearchParams(s.location.search);n.set(t,e),s.replace({...s.location,search:n.toString()})}),[t,s])]}function j(e){const{defaultValue:n,queryString:s=!1,groupId:t}=e,r=p(e),[l,a]=(0,i.useState)((()=>function({defaultValue:e,tabValues:n}){if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(e){if(!x({value:e,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${e}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return e}const s=n.find((e=>e.default))??n[0];if(!s)throw new Error("Unexpected error: 0 tabValues");return s.value}({defaultValue:n,tabValues:r}))),[o,d]=g({queryString:s,groupId:t}),[u,j]=function({groupId:e}){const n=function(e){return e?`docusaurus.tab.${e}`:null}(e),[s,t]=(0,h.Dv)(n);return[s,(0,i.useCallback)((e=>{n&&t.set(e)}),[n,t])]}({groupId:t}),f=(()=>{const e=o??u;return x({value:e,tabValues:r})?e:null})();(0,c.A)((()=>{f&&a(f)}),[f]);return{selectedValue:l,selectValue:(0,i.useCallback)((e=>{if(!x({value:e,tabValues:r}))throw new Error(`Can't select invalid tab value=${e}`);a(e),d(e),j(e)}),[d,j,r]),tabValues:r}}var f=s(2909);const y={tabList:"tabList_jhW_",tabItem:"tabItem_zJ9h"};var m=s(6070);function b({className:e,block:n,selectedValue:s,selectValue:i,tabValues:r}){const a=[],{blockElementScrollPositionUntilNextRender:c}=(0,l.a_)(),o=e=>{const n=e.currentTarget,t=a.indexOf(n),l=r[t].value;l!==s&&(c(n),i(l))},d=e=>{let n=null;switch(e.key){case"Enter":o(e);break;case"ArrowRight":{const s=a.indexOf(e.currentTarget)+1;n=a[s]??a[0];break}case"ArrowLeft":{const s=a.indexOf(e.currentTarget)-1;n=a[s]??a[a.length-1];break}}n?.focus()};return(0,m.jsx)("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,t.A)("tabs",{"tabs--block":n},e),children:r.map((({value:e,label:n,attributes:i})=>(0,m.jsx)("li",{role:"tab",tabIndex:s===e?0:-1,"aria-selected":s===e,ref:e=>{a.push(e)},onKeyDown:d,onClick:o,...i,className:(0,t.A)("tabs__item",y.tabItem,i?.className,{"tabs__item--active":s===e}),children:n??e},e)))})}function v({lazy:e,children:n,selectedValue:s}){const r=(Array.isArray(n)?n:[n]).filter(Boolean);if(e){const e=r.find((e=>e.props.value===s));return e?(0,i.cloneElement)(e,{className:(0,t.A)("margin-top--md",e.props.className)}):null}return(0,m.jsx)("div",{className:"margin-top--md",children:r.map(((e,n)=>(0,i.cloneElement)(e,{key:n,hidden:e.props.value!==s})))})}function w(e){const n=j(e);return(0,m.jsxs)("div",{className:(0,t.A)(r.G.tabs.container,"tabs-container",y.tabList),children:[(0,m.jsx)(b,{...n,...e}),(0,m.jsx)(v,{...n,...e})]})}function k(e){const n=(0,f.A)();return(0,m.jsx)(w,{...e,children:u(e.children)},String(n))}},6211:(e,n,s)=>{s.d(n,{A:()=>l});s(758);var i=s(3526);const t={tabItem:"tabItem_EVQD"};var r=s(6070);function l({children:e,hidden:n,className:s}){return(0,r.jsx)("div",{role:"tabpanel",className:(0,i.A)(t.tabItem,s),hidden:n,children:e})}},7082:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>a});var i=s(758);const t={},r=i.createContext(t);function l(e){const n=i.useContext(r);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),i.createElement(r.Provider,{value:n},e.children)}}}]);